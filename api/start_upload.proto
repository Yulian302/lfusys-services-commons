syntax = "proto3";

import "google/protobuf/timestamp.proto";

option go_package = "./api";
package api;

// creates a session for file uploading
service Uploader {
    // initiates a multipart upload session for a file
  rpc StartUpload (UploadRequest) returns (UploadReply);
    // gets current upload status
  rpc GetUploadStatus (UploadID) returns (StatusReply);
  // gets all user's files
  rpc GetFiles (UserInfo) returns (FilesReply);
}

message UploadRequest {
  string user_email = 1;
  uint64 file_size  = 2;
}

message UploadID {
  string upload_id = 1;
}

message UploadReply{
  string          upload_id    = 1;
  uint32          total_chunks = 2;
  repeated string upload_urls  = 3;
}

message StatusReply{
  string status   = 1;
  uint32 progress = 2;
  string message  = 3;
}

message UserInfo {
  string email = 1;
}

message FilesReply {
  repeated File files = 1;
}

message File {
  string                    id           = 1;
  string                    upload_id    = 2;
  string                    owner_email  = 3;
  uint64                    size         = 4;
  uint32                    total_chunks = 5;
  string                    checksum     = 6;
  google.protobuf.Timestamp created_at   = 7;
}