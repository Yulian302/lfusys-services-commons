syntax = "proto3";

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

option go_package = "github.com/Yulian302/lfusys-services-commons/api/uploader/v1;upoaderv1";
package uploader.v1;

// creates a session for file uploading
service Uploader {
    // initiates a multipart upload session for a file
  rpc StartUpload (UploadRequest) returns (UploadReply);
    // gets current upload status
  rpc GetUploadStatus (UploadID) returns (StatusReply);
  // gets all user's files
  rpc GetFiles (UserInfo) returns (FilesReply);
  // deletes a single user file
  rpc DeleteFile (FileDeleteRequest) returns (google.protobuf.Empty);
}

message UploadRequest {
  string user_email = 1;
  uint64 file_size  = 2;
  uint64 chunk_size = 3;
}

message UploadID {
  string upload_id = 1;
}

message UploadReply{
  string upload_id    = 1;
  uint32 total_chunks = 2;
}

message StatusReply{
  string status   = 1;
  uint32 progress = 2;
  string message  = 3;
}

message UserInfo {
  string email = 1;
}

message FilesReply {
  repeated File files = 1;
}

message File {
  string                    id           = 1;
  string                    upload_id    = 2;
  string                    owner_email  = 3;
  uint64                    size         = 4;
  uint32                    total_chunks = 5;
  string                    checksum     = 6;
  google.protobuf.Timestamp created_at   = 7;
}

message FileDeleteRequest{
  string file_id     = 1;
  string owner_email = 2;
}